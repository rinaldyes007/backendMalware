<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\Support\Facades\Input;
use DB;
use App\Presensi;
use App\User;
use Auth;
use App\Transformers\PresensiTransformer;

class PresensiController extends Controller
{
    public function Add(Request $request, Presensi $presensi)
    {
        $this->validate($request, [
            
            'status' => 'required',
            
        ]);

        if ($request->foto) {
            $data = array();
            $time = time();
            $entry = base64_decode($request->foto);
            $fotoselfie = imagecreatefromstring($entry);

            $directory = public_path('image/'.$time.".jpg");
            imagejpeg($fotoselfie, $directory);
            imagedestroy($fotoselfie);
        }

        $presensi = $presensi->create([
            'user_id' => $request->user_id,
            'status' => $request->status,
            'foto' => $time.".jpg"
           
        ]);

        $response = fractal()
            ->item($presensi)
            ->transformWith(new PresensiTransformer)
            ->toArray();

        return response()->json($response, 201);
    }

     public function index()
     {
         $presensis = Presensi::all();
         $nomor = 1;
    

         return view('tabelpresensi', compact('presensis', 'nomor'));
     }

     public function getDataPresensi()
     {
         $user = User::all();
         return view('addpresensi', compact('user'));
     }

     public function postDataPresensi(request $request)
     {
         
       

         $presensi = new Presensi();
         $presensi->user_id = Input::get('user_id');
         $presensi->status = Input::get('status');
         $presensi->created_at = Input::get('jam');
         
      
 
         $presensi->save();
         return redirect('addpresensi');
     }   

}
